<xml xmlns="http://www.w3.org/1999/xhtml"><block type="workflow_start" id="b8y9fJggqk+VoJzGC-cI" deletable="false" x="190" y="50"><field name="name">kilroy.ui_agent_template/manager/ui_create_pipeline</field><field name="version">1</field><field name="description"></field><field name="interactive">TRUE</field><field name="clean_up">TRUE</field><value name="OUTPUTS"><block type="process_variable_all" id="[baP4qH?m`vxpMcn}C4z"><mutation variable_count="2"></mutation><value name="INPUT0"><block type="process_variable" id="6ReKJH,wptQ3tuwIF/e7"><field name="process_variable_val">agent_pipelines</field></block></value><value name="INPUT1"><block type="process_variable" id="[;)iAOW,VJ)/fd|*}S-n"><field name="process_variable_val">msg</field></block></value></block></value><next><block type="step_group" id="@5#DWeAnwxT4Tf3(T2xd"><field name="role">*</field><field name="timer">24</field><field name="interactive">TRUE</field><field name="can_terminate">TRUE</field><field name="message"></field><statement name="success"><block type="set_value" id="M4~?9#B~IOtucOn~_!%#"><field name="variable">msg</field><field name="value"></field><next><block type="set_var_to" id="0mq4l4W5{y~L(h@w!`IM"><field name="var_name">class_abbrevs</field><value name="var_expr"><block type="var_json_parse" id="E1P`]gAv,UyiH9KY%@#L"><value name="json"><block type="var_value" id="r|tve,=jGSv$[_S#u%[g"><field name="value">{"ai_agent":"AI","wf_agent":"WF","viewer_agent":"VIEWER","chat_agent":"CHAT"}</field></block></value></block></value><next><block type="simple_inline_form" id="Gr=6Lb8ecfXDirI%j^KZ"><field name="form_id">default</field><field name="sif_title">Enter Pipeline JSON</field><field name="sif_desc"></field><statement name="form_field_data"><block type="form_textarea" id="CG5TV%9?WA$pIM##xmgS"><field name="form_field_name">pipeline_json</field><field name="form_field_label">Pipeline JSON</field><field name="form_field_placeholder">{}</field></block></statement><statement name="success"><block type="set_var_to" id="M#q2:yM^nz%J+yL)xK1I"><field name="var_name">pjson</field><value name="var_expr"><block type="var_json_parse" id="x9`Lcgu9yybOMFny%?sm"><value name="json"><block type="var_variable" id="tCq]-d=e}#3e9=U=(k80"><field name="var_name">pipeline_json</field></block></value></block></value><next><block type="set_var_to" id="|%e6GaP(.X,55e(sq%!Y"><field name="var_name">pipeline_name</field><value name="var_expr"><block type="var_object" id="Bqo4`*.kT0(*a:#j^~=%"><field name="obj_name">pjson</field><field name="field_name">pipeline_name</field></block></value><next><block type="set_var_to" id="PK-c;j^V15%@do0XR~1D"><field name="var_name">pipeline_desc</field><value name="var_expr"><block type="var_object" id="WYB;3Q:+x%iHvI1MQmcv"><field name="obj_name">pjson</field><field name="field_name">pipeline_desc</field></block></value><next><block type="set_var_to" id="{/ZI?:t//JATjGk9k=6H"><field name="var_name">pipeline_uid</field><value name="var_expr"><block type="var_object" id="$M-{m[Vk@0.L`]v2bRs`"><field name="obj_name">pjson</field><field name="field_name">pipeline_uid</field></block></value><next><block type="comment" id="{AfG3|Pj0ZobTdrqyUO^"><field name="comment">get pipeline name to keep a list of associated aliases we create</field><next><block type="comment" id="N*fj5CSvAy4d)_7p(~R9"><field name="comment">webhook_args has "agents" array to create</field><next><block type="set_var_to" id="M?!qcW:?kIn#Gl^80TAo"><field name="var_name">agents</field><value name="var_expr"><block type="var_object" id="yA;@3;z:+Lf]haHIR*B;"><field name="obj_name">pjson</field><field name="field_name">agents</field></block></value><next><block type="set_var_to" id="E}DMPjgtQK0zlh14KRbK"><field name="var_name">agents_len</field><value name="var_expr"><block type="array_length" id="(@?~vdO9P,O;:f`52X7Y"><field name="array_name">agents</field></block></value><next><block type="list_reset" id="i9#5En.:Sl4RH_efY)dn"><field name="list_name">aliases</field><next><block type="set_var_to" id=".Nxa_clkO*i?XHjKz2fl"><field name="var_name">agents_by_alias</field><value name="var_expr"><block type="var_new_obj" id="E(}SAA7-:vto18,CVcDd"></block></value><next><block type="while_loop" id="]M=^gg+0NzPB)/Cc}See"><field name="condition">${agents_len} &gt; 0</field><statement name="do"><block type="set_var_to" id="6-e%-K{5%|bf.?@WzV|d"><field name="var_name">agent</field><value name="var_expr"><block type="array_shift" id="hBB!(m-+:tkT[.`iVzcp"><field name="array_name">agents</field></block></value><next><block type="set_var_to" id="M9%xlp!DC-slwsz1OG)w"><field name="var_name">name</field><value name="var_expr"><block type="var_object" id="-{`)s56yQ2]@iLYhVP_L"><field name="obj_name">agent</field><field name="field_name">agent_name</field></block></value><next><block type="set_var_to" id="[f6G)eqd]H=Nh2M~PHhF"><field name="var_name">class</field><value name="var_expr"><block type="var_object" id="*dB!m*u$Kl5ePb]Z7]]l"><field name="obj_name">agent</field><field name="field_name">agent_class</field></block></value><next><block type="set_var_to" id="3=~.bnxub$rB2Qm$M5Ih"><field name="var_name">desc</field><value name="var_expr"><block type="var_object" id="x`4-.S@b=H@IRmBkT1ZZ"><field name="obj_name">agent</field><field name="field_name">agent_desc</field></block></value><next><block type="set_var_to" id="6U0G{ai@*4+4LHYkf-Z3"><field name="var_name">alias</field><value name="var_expr"><block type="var_object" id="-=)wyW8yAwJT=4EFQq:e"><field name="obj_name">agent</field><field name="field_name">agent_alias</field></block></value><next><block type="set_var_to" id="Sagt}Y.L8A3|_KZrb:d!"><field name="var_name">class_str</field><value name="var_expr"><block type="var_object" id="g7!z9v{wKx8AO|i.hn_c"><field name="obj_name">class_abbrevs</field><field name="field_name">${class}</field></block></value><next><block type="if_then_else" id="eqE)`d=oOU~.27Ogqqiz"><field name="condition">"${class}" == "viewer_agent" || "${class}" == "chat_agent"</field><statement name="then"><block type="comment" id="m[`?AVVc];KO7ReDW_OO"><field name="comment">because agents can be implemented in other</field><next><block type="comment" id=";5:n!_KU-[K[JMiA|AHE"><field name="comment">kilroy apps, we have to call their webhook</field><next><block type="comment" id="__8=;,O`5hXG|CW7Ed-;"><field name="comment">to instantiate them.</field><next><block type="set_var_to" id="9!:R(99D5:di:VlCMI5i"><field name="var_name">diagram_alias</field><value name="var_expr"><block type="var_object" id="Z/HYY|2@,%UO%UvU0.J7"><field name="obj_name">agent</field><field name="field_name">wf_diagram_alias</field></block></value><next><block type="trigger_pd" id="u^,?$wd9qeP.E,prQij-"><field name="pd_id">${diagram_alias}</field><field name="trigger_name">create_${class}</field><field name="synchronous">TRUE</field><field name="copyOutputs">FALSE</field><field name="args">{"wfCurrentUserId":"${wfCurrentUserId}","pipeline_name":"${pipeline_name}","agent": ${agent}}</field><next><block type="set_var_to" id="Dl;Nk)#9[!y2EHUX7WR^"><field name="var_name">res</field><value name="var_expr"><block type="var_results" id="{O{mcl48DpxEJ9y_/rWh"></block></value><next><block type="if_then_else" id="!Kjc(W4^+U6tMP~vKnk`"><field name="condition">"${res}" == "${diagram_alias}"</field><statement name="then"><block type="browser_alert" id="zc~pDWgZ6-Sa2!iBauIA"><field name="message">ERROR! ${class} not launched. ${diagram_alias} wasn't found (running).</field><field name="sound">audio_error</field><field name="sound_url"></field><next><block type="set_value" id="(nPyC^*l[g(P,c@00+^d"><field name="variable">msg</field><field name="value">${msg} \nERROR! ${class} not launched. ${diagram_alias} wasn't found (running).</field></block></next></block></statement></block></next></block></next></block></next></block></next></block></next></block></next></block></statement><statement name="else"><block type="start_app_diagram" id="L-fWLN;x[^,9#MRFM(jA"><field name="pdclass">${class}</field><field name="pdalias">${alias}</field><field name="pddesc">(${pipeline_name}) ${class_str}: ${name}: ${desc}</field><field name="pdargs">{"config": ${agent}}</field><next><block type="set_var_to" id="JT|Wqn=|wBRFBn-bhzhU"><field name="var_name">res</field><value name="var_expr"><block type="var_results" id="h2[,/QU+$,2;md$(QpB["></block></value></block></next></block></statement><next><block type="array_push" id="2(*PNz8k{`ee?9E[1rs("><field name="array_name">aliases</field><value name="var_expr"><block type="var_variable" id="5ZxTrrR,nN~CadzNC|C*"><field name="var_name">res</field></block></value><next><block type="set_obj_to" id="46jr4,t7C#.I^t?Km+oX"><field name="var_name">agents_by_alias</field><field name="field_name">${res}</field><value name="var_expr"><block type="var_variable" id=",Z=3m_CKW+gkQt]umncP"><field name="var_name">agent</field></block></value><next><block type="set_var_to" id="%WH/vyte}zT@GvGQ2oTv"><field name="var_name">agents_len</field><value name="var_expr"><block type="array_length" id="t/W(/k$5/yK5`_D|mI3i"><field name="array_name">agents</field></block></value></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement><next><block type="start_app_diagram" id="tGz;;uOC^8!#*oLEhruP"><field name="pdclass">pipeline</field><field name="pdalias">kilroy.ai.pipeline.${pipeline_uid}</field><field name="pddesc"> PIPELINE: ${pipeline_name} - ${pipeline_desc}</field><field name="pdargs">{"pipeline_json": ${pjson}, "aliases":${aliases}, "agents_by_alias":${agents_by_alias}}</field><next><block type="set_var_to" id="{.a@a.Sr=?!~~6LO}cgz"><field name="var_name">res</field><value name="var_expr"><block type="var_results" id="~h_%YRZedpT2TXgiW/`4"></block></value><next><block type="show_app_diagram" id="a|rJcy;pb6+HSt[OAg;W"><field name="pdalias">${res}</field><next><block type="comment" id="m0nh7]rE-?4N_YH~9f[@"><field name="comment">now show the newly launched agents</field><next><block type="set_var_to" id="0iFl=Y-4klT7%SG@kZQ^"><field name="var_name">display_order</field><value name="var_expr"><block type="var_object" id="nFEND`92F{aGo/I/%Ucn"><field name="obj_name">pjson</field><field name="field_name">display_order</field></block></value><next><block type="set_var_to" id="#0$ojT;?5I$ggEd29oPc"><field name="var_name">disp_len</field><value name="var_expr"><block type="array_length" id="+1Uqq7$Ph+8*$0!TF:?7"><field name="array_name">display_order</field></block></value><next><block type="while_loop" id="7g.DNHW1Aw8~8;lvJ}l|"><field name="condition">${disp_len} &gt; 0</field><statement name="do"><block type="set_var_to" id="r}6$)3.M$T~a,j%m`~oG"><field name="var_name">alias</field><value name="var_expr"><block type="array_shift" id="GN*aD)Zi=lF!:IF_V!{w"><field name="array_name">display_order</field></block></value><next><block type="show_app_diagram" id="aD{WgRe]LMId+k@,^yP#"><field name="pdalias">${alias}</field><next><block type="set_var_to" id="[%LH`/v[u)BMzD[^|Geu"><field name="var_name">disp_len</field><value name="var_expr"><block type="array_length" id="B]u3LE5]C`;tMhYTU0gh"><field name="array_name">display_order</field></block></value></block></next></block></next></block></statement></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block></next></block></next></block></statement><next><block type="workflow_end" id="Ub?h9a`t,Etsd=M0U|uJ"></block></next></block></next></block></xml>